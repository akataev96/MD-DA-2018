---
title: "Lab2"
author: "Andrei Kataev"
date: '22 декабря 2018 г '
output: html_document
---

##Лабораторная работа 2
#Исходные данные

Установленная среда R включает в себя набор заранее сконфигурированных массивов данных. В данной лабораторной требуется использовать одну из них — датафрейм из 93 машин-новинок 1993 года. Для того, чтобы загрузить данный датафрейм, необходимо выполнить следующие команды:
```{r}
library(MASS)
data(Cars93)
```
Для того, чтобы ознакомиться со структурой и составом данных, можно выполнить команду 
```{r}
View(Cars93)
```
или нажать на соответствующую кнопку в RStudio.

#Задание 1

Выполните команду ``summary()`` на полном наборе данных. Можно ли по результату выполнения сказать сколько строк в датафрейме? Если да, напишите сколько. Если нет, то приведите другой способ.
```{r}
summary(Cars93)
nrow(Cars93)
```
В датафрейме 93 строки.

Найдите среднюю цену машин с задним приводом.
```{r}
mean(subset(Cars93$Price,Cars93$DriveTrain=="Rear"))
```

Найдите минимальное число лошадиных сил автомобиля для 7 пассажиров. Для 6 пассажиров.
```{r}
min(subset(Cars93$Horsepower,Cars93$Passengers=="7"))
min(subset(Cars93$Horsepower,Cars93$Passengers=="6"))
```

Найдите машины с максимальным, минимальным и средним(медианой) расстоянием, которая машина может проехать по трассе. Вам понадобятся 2 колонки, чтобы рассчитать расстояние. Какие?
```{r}
Cars93 <- cbind(Cars93, distances =Cars93$MPG.highway*Cars93$Fuel.tank.capacity)
max<-Cars93[Cars93$distances== max(Cars93$distances) ,]
medium<-Cars93[Cars93$distances== median(Cars93$distances) ,]
min<-Cars93[Cars93$distances== min(Cars93$distances) ,]
min
medium
max
```
Необходимые колонки MPG.highway и Fuel.tank.capacity.

#Задание 2

В самом начале занятий приводился пример с фабрикой и производством автомобилей. Ниже приведён пример кода, который старается оптимизировать выпуск продукции ориентируясь на доступные ресурсы.
Выполните код и запустите эту функцию ``factory.run()``.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(output)
}
```

С каким входными значениями функция вызвана? Какой получился результат?
Функция была вызвана с входными параметрами по умолчанию: 1 машина и 1 грузовик. В результате получилось 10.18278 автомобилей и 19.85173 грузовиков, т.к. функция оптимизирует производство, исходя из доступных ресурсов.

Повторите вызов 4 раза. Полученные ответы отличаются от полученных ранее? Если да, почему? Если нет, почему?
Полученные ответы отличаются от полученных ранее на десятые доли:
Автомобили: 9.921044, 10.16153, 9.937276, 10.70880. Грузовики: 19.978748, 19.86983, 19.980757, 19.51562. 
Значения различаются из-за того, что в функции есть команда ``runif()``, которая выполняется только если одного ресурса потреблено слишком много, а другого недостаточно. Она увеличивает план на случайную величину.

В приведённом коде, переменные steps и output находятся внутри алгоритма. Измените функцию так, чтобы она возвращала число шагов и произведённое количество машин.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    names(steps) <- "количество шагов";
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(list(steps,needed,output))
}
```

Установите план равный тридцати автомобилям и 20 грузовикам и выполните функцию.
Какой получили результат?
```{r}
factory.run(30, 20)
```

Каким получился итоговый запрос ресурсов (переменная needed)?
1595.10175 трудодней и 69.54475 единиц стали.

Как много итераций пришлось пройти, чтобы получить ответ (переменная steps)?
558

Для подсчёта можно пользоваться функциями печати (print, message) или вернуть результат из функции.